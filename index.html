<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#208090">
    <meta name="description" content="Divida despesas de casal de forma proporcional Ã  renda. Simples, justo e transparente.">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="DivideCerto">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Ãcones -->
    <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192.png">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    
    <title>DivideCerto - Dividindo contas com justiÃ§a</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Seu conteÃºdo continua EXATAMENTE igual -->
    <div class="container">
        <header>
            <div class="header-top">
                <div class="title-section">
                    <h1>ğŸ’° DivideCerto</h1>
                    <p style="margin: 5px 0 0 0; font-size: 0.9rem; opacity: 0.9;">Dividindo contas com justiÃ§a</p>
                </div>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <button class="btn-theme" onclick="toggleTheme()" title="Alternar tema">
                        <span id="themeIcon">ğŸŒ™</span>
                    </button>
                    <span class="version-badge">V20 PWA</span>
                </div>
            </div>
            <!-- Resto do header continua igual -->


            <div class="header-grid">
                <div class="header-card">
                    <div class="header-label">ğŸ“… Data Inicial</div>
                    <div class="header-input-group">
                        <input type="month" id="startDateInput" class="header-input">
                        <button class="btn-header" onclick="updateStartDate()">âœ“</button>
                    </div>
                </div>

                <div class="header-card">
                    <div class="header-label">ğŸ’µ Saldo Conta</div>
                    <div class="header-input-group">
                        <input type="number" id="balanceInput" class="header-input" step="0.01" placeholder="0,00">
                        <button class="btn-header" onclick="updateBalance()">âœ“</button>
                    </div>
                </div>

                <div class="header-card">
                    <div class="header-label">ğŸ“Š Renda Total MÃªs</div>
                    <div class="header-value" id="totalIncomeDisplay">R$ 0,00</div>
                </div>
            </div>
        </header>

        <div id="successAlert" class="alert alert-success"></div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('renda')">ğŸ’µ Renda</button>
            <button class="tab" onclick="switchTab('despesas')">ğŸ“‹ Despesas Conta Compartilhada</button>
            <button class="tab" onclick="switchTab('descontos')">ğŸ’³ Descontos</button>
            <button class="tab" onclick="switchTab('liquidacao')">ğŸ§® LiquidaÃ§Ã£o</button>
            <button class="tab" onclick="switchTab('extrato1')">ğŸ“„ <span id="person1TabName">Pessoa 1</span></button>
            <button class="tab" onclick="switchTab('extrato2')">ğŸ“„ <span id="person2TabName">Pessoa 2</span></button>
            <button class="tab" onclick="switchTab('categorias')">ğŸ·ï¸ Categorias</button>
            <button class="tab" onclick="switchTab('historico')">ğŸ“Š HistÃ³rico</button>
            <button class="tab" onclick="switchTab('feriados')">ğŸ“… Feriados</button>
            <button class="tab" onclick="switchTab('backup')">ğŸ’¾ Backup</button>
        </div>

        <!-- Modal Editar Despesa -->
        <div id="editExpenseModal" class="modal">
            <div class="modal-content">
                <h2 class="modal-header">âœï¸ Editar Despesa</h2>
                <div class="form-group">
                    <label>DescriÃ§Ã£o</label>
                    <input type="text" id="editExpenseName">
                </div>
                <div class="form-group" style="margin-top: 15px;">
                    <label>Valor (R$)</label>
                    <input type="number" id="editExpenseAmount" step="0.01">
                </div>
                <div class="form-group" style="margin-top: 15px;">
                    <label>MÃªs</label>
                    <input type="month" id="editExpenseMonth">
                </div>
                <div class="form-group" style="margin-top: 15px;">
                    <label>Categoria</label>
                    <select id="editExpenseCategory">
                        <option value="moradia">ğŸ  Moradia</option>
                        <option value="alimentacao">ğŸ½ï¸ AlimentaÃ§Ã£o</option>
                        <option value="transporte">ğŸš— Transporte</option>
                        <option value="saude">ğŸ¥ SaÃºde</option>
                        <option value="lazer">ğŸ® Lazer</option>
                        <option value="educacao">ğŸ“š EducaÃ§Ã£o</option>
                        <option value="outros">ğŸ“¦ Outros</option>
                    </select>
                </div>
                <div class="modal-buttons">
                    <button class="btn btn-primary" onclick="saveExpenseEdit()">ğŸ’¾ Salvar</button>
                    <button class="btn btn-danger" onclick="closeEditExpenseModal()">âŒ Cancelar</button>
                </div>
            </div>
        </div>

        <!-- Modal Editar Desconto -->
        <div id="editTransactionModal" class="modal">
            <div class="modal-content">
                <h2 class="modal-header">âœï¸ Editar Desconto</h2>
                <div class="form-group">
                    <label>Pessoa</label>
                    <select id="editTransactionPerson">
                        <option value="">Selecione...</option>
                    </select>
                </div>
                <div class="form-group" style="margin-top: 15px;">
                    <label>DescriÃ§Ã£o</label>
                    <input type="text" id="editTransactionDescription">
                </div>
                <div class="form-group" style="margin-top: 15px;">
                    <label>Valor (R$)</label>
                    <input type="number" id="editTransactionAmount" step="0.01">
                </div>
                <div class="form-group" style="margin-top: 15px;">
                    <label>MÃªs</label>
                    <input type="month" id="editTransactionMonth">
                </div>
                <div class="form-group" style="margin-top: 15px;">
                    <label>Categoria</label>
                    <select id="editTransactionCategory">
                        <option value="moradia">ğŸ  Moradia</option>
                        <option value="alimentacao">ğŸ½ï¸ AlimentaÃ§Ã£o</option>
                        <option value="transporte">ğŸš— Transporte</option>
                        <option value="saude">ğŸ¥ SaÃºde</option>
                        <option value="lazer">ğŸ® Lazer</option>
                        <option value="educacao">ğŸ“š EducaÃ§Ã£o</option>
                        <option value="outros">ğŸ“¦ Outros</option>
                    </select>
                </div>
                <div class="modal-buttons">
                    <button class="btn btn-primary" onclick="saveTransactionEdit()">ğŸ’¾ Salvar</button>
                    <button class="btn btn-danger" onclick="closeEditTransactionModal()">âŒ Cancelar</button>
                </div>
            </div>
        </div>

        <!-- Tab Renda -->
        <div id="renda" class="tab-content active">
            <div class="card">
                <h2 class="card-title">ConfiguraÃ§Ã£o de Renda Mensal</h2>
                
                <div class="alert alert-info show">
                    <strong>â„¹ï¸ Importante:</strong> Configure os valores de salÃ¡rio e auxÃ­lios. Use a calculadora abaixo como referÃªncia para auxÃ­lios variÃ¡veis.
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label>Nome Pessoa 1</label>
                        <input type="text" id="person1Name" placeholder="Ex: JoÃ£o">
                    </div>
                    <div class="form-group">
                        <label>Nome Pessoa 2</label>
                        <input type="text" id="person2Name" placeholder="Ex: Maria">
                    </div>
                    <div class="form-group">
                        <label>SalÃ¡rio Pessoa 1 (R$)</label>
                        <input type="number" id="person1Salary" placeholder="0,00" step="0.01">
                    </div>
                    <div class="form-group">
                        <label>SalÃ¡rio Pessoa 2 (R$)</label>
                        <input type="number" id="person2Salary" placeholder="0,00" step="0.01">
                    </div>
                    <div class="form-group">
                        <label>AuxÃ­lio AlimentaÃ§Ã£o Pessoa 1 (R$)</label>
                        <input type="number" id="person1Allowance" placeholder="0,00" step="0.01">
                    </div>
                    <div class="form-group">
                        <label>AuxÃ­lio AlimentaÃ§Ã£o Pessoa 2 (R$)</label>
                        <input type="number" id="person2Allowance" placeholder="0,00" step="0.01">
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn btn-primary" onclick="saveIncome()">ğŸ’¾ Salvar Renda</button>
                </div>

                <div class="pie-chart-container" id="pieChartContainer" style="display: none;">
                    <div class="pie-chart" id="pieChart"></div>
                    <div class="pie-legend" id="pieLegend"></div>
                </div>

                <h3 style="margin-top: 40px; margin-bottom: 15px; color: var(--primary-color);">ğŸ§® Calculadora de AuxÃ­lio VariÃ¡vel</h3>
                <div class="alert alert-info show">
                    <strong>ğŸ’¡ FÃ³rmula:</strong> VA Fixo + (Dias Ãºteis Ã— Valor diÃ¡rio Ã— 0,5)
                    <br><em>Esta calculadora Ã© apenas para referÃªncia. Atualize manualmente o campo "AuxÃ­lio AlimentaÃ§Ã£o" acima.</em>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label>VA Fixo (R$)</label>
                        <input type="number" id="vaFixed" placeholder="702,85" step="0.01" value="702.85">
                    </div>
                    <div class="form-group">
                        <label>Valor VR DiÃ¡rio (R$)</label>
                        <input type="number" id="vrDaily" placeholder="37,33" step="0.01" value="37.33">
                    </div>
                    <div class="form-group">
                        <label>Dias Ãšteis do MÃªs</label>
                        <input type="number" id="workDays" placeholder="Auto" min="0" max="31">
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn btn-success" onclick="calculateWorkDays()">ğŸ”„ Recalcular</button>
                </div>

                <div class="workdays-info">
                    <strong>ğŸ“… Dias Ãšteis:</strong> <span id="calculatedWorkDays">-</span> dias | 
                    <strong>ğŸ’° VA Total:</strong> <span id="calculatedVA">R$ 0,00</span>
                </div>
            </div>
        </div>

        <!-- Tab Despesas -->
        <div id="despesas" class="tab-content">
            <div class="card">
                <h2 class="card-title">Despesas Pagas pela Conta Compartilhada</h2>
                
                <div class="alert alert-info show">
                    <strong>â„¹ï¸ Dica:</strong> O mÃªs padrÃ£o Ã© preenchido automaticamente com a Data Inicial configurada no topo.
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label>ğŸ“… MÃªs da Despesa</label>
                        <input type="month" id="expenseMonth" required>
                    </div>
                    <div class="form-group">
                        <label>DescriÃ§Ã£o da Despesa</label>
                        <input type="text" id="expenseName" placeholder="Ex: Aluguel">
                    </div>
                    <div class="form-group">
                        <label>Valor (R$)</label>
                        <input type="number" id="expenseAmount" placeholder="0,00" step="0.01">
                    </div>
                    <div class="form-group">
                        <label>Categoria</label>
                        <select id="expenseCategory">
                            <option value="moradia">ğŸ  Moradia</option>
                            <option value="alimentacao">ğŸ½ï¸ AlimentaÃ§Ã£o</option>
                            <option value="transporte">ğŸš— Transporte</option>
                            <option value="saude">ğŸ¥ SaÃºde</option>
                            <option value="lazer">ğŸ® Lazer</option>
                            <option value="educacao">ğŸ“š EducaÃ§Ã£o</option>
                            <option value="outros">ğŸ“¦ Outros</option>
                        </select>
                    </div>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="expenseRecurring" onchange="toggleExpenseOptions()">
                    <label for="expenseRecurring">ğŸ”„ Despesa Recorrente</label>
                </div>

                <div id="expenseRecurringOptions" class="recurring-options">
                    <div class="form-group">
                        <label>AtÃ© qual mÃªs? (vazio = 12 meses)</label>
                        <input type="month" id="expenseEndMonth">
                    </div>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="expenseInstallment" onchange="toggleExpenseOptions()">
                    <label for="expenseInstallment">ğŸ’³ Parcelado</label>
                </div>

                <div id="expenseInstallmentOptions" class="recurring-options">
                    <div class="form-group">
                        <label>NÃºmero de Parcelas</label>
                        <input type="number" id="expenseInstallments" placeholder="Ex: 12" min="2" max="120">
                    </div>
                    <div class="form-group">
                        <label>O valor informado Ã©:</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="expenseTypeTotal" name="expenseType" value="total" checked>
                                <label for="expenseTypeTotal">ğŸ’° Valor Total (dividir)</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="expenseTypePerInstallment" name="expenseType" value="perInstallment">
                                <label for="expenseTypePerInstallment">ğŸ“ Valor da Parcela</label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn btn-primary" onclick="addExpense()">â• Adicionar Despesa</button>
                </div>

                <div style="margin: 30px 0; padding: 15px; background: var(--card-bg); border-radius: 10px; border: 2px solid var(--border-color);">
                    <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 10px;">
                        <strong style="color: var(--text-primary);">ğŸ” Filtrar por status:</strong>
                        <select id="expenseFilter" onchange="loadExpensesView()" style="padding: 8px; border-radius: 6px; border: 2px solid var(--border-color); background: var(--input-bg); color: var(--text-primary);">
                            <option value="all">Todos</option>
                            <option value="pending">â³ Pendentes</option>
                            <option value="paid">âœ… Pagos</option>
                        </select>
                    </div>
                </div>

                <div id="expensesView" style="margin-top: 40px;"></div>
            </div>
        </div>

        <!-- Tab Descontos -->
        <div id="descontos" class="tab-content">
            <div class="card">
                <h2 class="card-title">Descontos / Pagamentos Individuais</h2>
                
                <div class="alert alert-info show">
                    <strong>â„¹ï¸ Dica:</strong> O mÃªs padrÃ£o Ã© preenchido automaticamente com a Data Inicial configurada no topo.
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label>ğŸ“… MÃªs do Desconto</label>
                        <input type="month" id="transactionMonth" required>
                    </div>
                    <div class="form-group">
                        <label>Pessoa</label>
                        <select id="transactionPerson">
                            <option value="">Selecione...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>DescriÃ§Ã£o</label>
                        <input type="text" id="transactionDescription" placeholder="Ex: CartÃ£o">
                    </div>
                    <div class="form-group">
                        <label>Valor (R$)</label>
                        <input type="number" id="transactionAmount" placeholder="0,00" step="0.01">
                    </div>
                    <div class="form-group">
                        <label>Categoria</label>
                        <select id="transactionCategory">
                            <option value="moradia">ğŸ  Moradia</option>
                            <option value="alimentacao">ğŸ½ï¸ AlimentaÃ§Ã£o</option>
                            <option value="transporte">ğŸš— Transporte</option>
                            <option value="saude">ğŸ¥ SaÃºde</option>
                            <option value="lazer">ğŸ® Lazer</option>
                            <option value="educacao">ğŸ“š EducaÃ§Ã£o</option>
                            <option value="outros">ğŸ“¦ Outros</option>
                        </select>
                    </div>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="transactionRecurring" onchange="toggleTransactionOptions()">
                    <label for="transactionRecurring">ğŸ”„ Desconto Recorrente</label>
                </div>

                <div id="transactionRecurringOptions" class="recurring-options">
                    <div class="form-group">
                        <label>AtÃ© qual mÃªs? (vazio = 12 meses)</label>
                        <input type="month" id="transactionEndMonth">
                    </div>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="transactionInstallment" onchange="toggleTransactionOptions()">
                    <label for="transactionInstallment">ğŸ’³ Parcelado</label>
                </div>

                <div id="transactionInstallmentOptions" class="recurring-options">
                    <div class="form-group">
                        <label>NÃºmero de Parcelas</label>
                        <input type="number" id="transactionInstallments" placeholder="Ex: 12" min="2" max="120">
                    </div>
                    <div class="form-group">
                        <label>O valor informado Ã©:</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="transactionTypeTotal" name="transactionType" value="total" checked>
                                <label for="transactionTypeTotal">ğŸ’° Valor Total (dividir)</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="transactionTypePerInstallment" name="transactionType" value="perInstallment">
                                <label for="transactionTypePerInstallment">ğŸ“ Valor da Parcela</label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn btn-primary" onclick="addTransaction()">â• Adicionar Desconto</button>
                </div>

                <div style="margin: 30px 0; padding: 15px; background: var(--card-bg); border-radius: 10px; border: 2px solid var(--border-color);">
                    <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 10px;">
                        <strong style="color: var(--text-primary);">ğŸ” Filtrar por status:</strong>
                        <select id="transactionFilter" onchange="loadTransactionsView()" style="padding: 8px; border-radius: 6px; border: 2px solid var(--border-color); background: var(--input-bg); color: var(--text-primary);">
                            <option value="all">Todos</option>
                            <option value="pending">â³ Pendentes</option>
                            <option value="paid">âœ… Pagos</option>
                        </select>
                    </div>
                </div>

                <div id="transactionsView" style="margin-top: 40px;"></div>
            </div>
        </div>

        <!-- Tab LiquidaÃ§Ã£o -->
        <div id="liquidacao" class="tab-content">
            <div class="card">
                <h2 class="card-title">LiquidaÃ§Ã£o Mensal</h2>
                
                <div class="form-group" style="max-width: 300px; margin-bottom: 30px;">
                    <label>ğŸ“… Selecione o MÃªs</label>
                    <input type="month" id="liquidationMonth" onchange="calculateLiquidation()">
                </div>

                <div id="liquidationDetails"></div>
            </div>
        </div>

        <!-- Tab Extrato 1 -->
        <div id="extrato1" class="tab-content">
            <div class="card">
                <h2 class="card-title">ğŸ“„ Extrato - <span id="extrato1PersonName">Pessoa 1</span></h2>
                
                <div class="form-group" style="max-width: 300px; margin-bottom: 30px;">
                    <label>ğŸ“… Selecione o MÃªs</label>
                    <input type="month" id="extrato1Month" onchange="loadExtrato('person1')">
                </div>

                <div id="extrato1Content"></div>
            </div>
        </div>

        <!-- Tab Extrato 2 -->
        <div id="extrato2" class="tab-content">
            <div class="card">
                <h2 class="card-title">ğŸ“„ Extrato - <span id="extrato2PersonName">Pessoa 2</span></h2>
                
                <div class="form-group" style="max-width: 300px; margin-bottom: 30px;">
                    <label>ğŸ“… Selecione o MÃªs</label>
                    <input type="month" id="extrato2Month" onchange="loadExtrato('person2')">
                </div>

                <div id="extrato2Content"></div>
            </div>
        </div>

        <!-- Tab Categorias -->
        <div id="categorias" class="tab-content">
            <div class="card">
                <h2 class="card-title">ğŸ·ï¸ AnÃ¡lise por Categorias</h2>
                
                <div class="form-group" style="max-width: 300px; margin-bottom: 30px;">
                    <label>ğŸ“… Selecione o MÃªs</label>
                    <input type="month" id="categoryMonth" onchange="loadCategoryAnalysis()">
                </div>

                <div id="categoryContent"></div>
            </div>
        </div>

        <!-- Tab HistÃ³rico -->
        <div id="historico" class="tab-content">
            <div class="card">
                <h2 class="card-title">HistÃ³rico Financeiro</h2>
                <div id="historyTable"></div>
            </div>
        </div>

        <!-- Tab Feriados -->
        <div id="feriados" class="tab-content">
            <div class="card">
                <h2 class="card-title">GestÃ£o de Feriados</h2>
                
                <h3 style="margin-top: 20px; margin-bottom: 15px; color: var(--primary-color);">â• Adicionar Feriado</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Data do Feriado</label>
                        <input type="date" id="holidayDate">
                    </div>
                    <div class="form-group">
                        <label>Nome do Feriado</label>
                        <input type="text" id="holidayName" placeholder="Ex: Natal">
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn btn-primary" onclick="addHoliday()">â• Adicionar Feriado</button>
                </div>

                <h3 style="margin-top: 40px; margin-bottom: 15px; color: var(--primary-color);">ğŸ“‹ Feriados Cadastrados</h3>
                <div class="holidays-container" id="holidaysList"></div>
            </div>
        </div>

        <!-- Tab Backup -->
        <div id="backup" class="tab-content">
            <div class="card">
                <h2 class="card-title">Backup e RestauraÃ§Ã£o</h2>
                
                <div class="button-group">
                    <button class="btn btn-success" onclick="exportData()">ğŸ“¥ Exportar Dados</button>
                    <button class="btn btn-warning" onclick="document.getElementById('importFile').click()">ğŸ“¤ Importar Dados</button>
                    <button class="btn btn-danger" onclick="clearAllData()">ğŸ—‘ï¸ Limpar Tudo</button>
                </div>

                <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">

                <div class="alert alert-info show" style="margin-top: 20px;">
                    <strong>âš ï¸ AtenÃ§Ã£o:</strong> Ao importar, todos os dados atuais serÃ£o substituÃ­dos.
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    
    <!-- PWA Installation -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(reg => console.log('âœ… PWA Registrado!'))
                    .catch(err => console.log('âŒ Erro PWA:', err));
            });
        }
        
        // Detectar instalaÃ§Ã£o
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // Mostrar alerta sugerindo instalaÃ§Ã£o
            const installAlert = document.createElement('div');
            installAlert.className = 'alert alert-info show';
            installAlert.style.cssText = 'position: fixed; top: 20px; right: 20px; z-index: 9999; max-width: 400px;';
            installAlert.innerHTML = `
                <strong>ğŸ“± Instalar DivideCerto</strong><br>
                Adicione Ã  tela inicial para acesso rÃ¡pido!
                <button onclick="installPWA()" style="margin-top: 10px; padding: 8px 16px; background: var(--primary-color); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">
                    â¬‡ï¸ Instalar Agora
                </button>
                <button onclick="this.parentElement.remove()" style="margin-top: 10px; margin-left: 10px; padding: 8px 16px; background: transparent; color: var(--text-primary); border: 2px solid var(--border-color); border-radius: 6px; cursor: pointer;">
                    âœ• Agora nÃ£o
                </button>
            `;
            document.body.appendChild(installAlert);
        });
        
        function installPWA() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('âœ… PWA instalado!');
                    }
                    deferredPrompt = null;
                });
            }
        }
    </script>
</body>
</html>

